
routes:
  - path: /k8s
    workflow:
      ref: k8s-docs

workflows:
  - name: k8s-docs
    stages:
      - name: k8s-docs-rag
        steps:
          - type: embedder
            ref: ollama/arctic
            action: generate
            params:
              input: $_input
            var: embedding

          - type: storage
            ref: duckdb/main
            action: lookup.cosine
            params:
              embedding: $embedding
              collection: k8s
              threshold: 0.75
              limit: 3
            var: context

          - type: service
            ref: ollama/phi
            action: completion
            params:
              context: $context
              prompt: $_input
            var: _response

embedders:
  - name: ollama/arctic
    type: ollama
    config:
      model: snowflake-arctic-embed

storage:
  - name: duckdb/main
    type: duckdb
    config:
      dbFilePath: .data/ragoo.db

services:
  - name: ollama/phi
    type: ollama
    config:
      model: phi3

importers:
  - name: k8s-files
    type: file
    config:
      directory: .files
    steps:
      - type: embedder
        ref: ollama/arctic
        action: generate
        params:
          input: $_chunk
        var: embedding

      - type: storage
        ref: duckdb/main
        action: insert.embedding
        params:
          embedding: $embedding
          ref: $_ref
          collection: k8s